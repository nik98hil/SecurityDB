# DROP DATABASE SECURITY;

CREATE DATABASE SECURITY;

USE SECURITY;

CREATE TABLE user_accounts(
    userID INT NOT NULL,
    phone varchar(12) NOT NULL DEFAULT 'NULL',
    userName varchar(100) NOT NULL,
    CONSTRAINT UAPK PRIMARY KEY (userID)
);

CREATE TABLE DbTable(
    tableName varchar(100) NOT NULL,
    ownerID int NOT NULL,
    CONSTRAINT tpk PRIMARY KEY (tableName),
    CONSTRAINT tfk FOREIGN KEY (ownerID) REFERENCES user_accounts(userID)
);

CREATE TABLE privileges(
    pid int NOT NULL ,
    privType varchar(100) NOT NULL,
    CONSTRAINT ppk PRIMARY KEY (pid)
);


CREATE TABLE user_role(
    roleName varchar(100) NOT NULL,
    description varchar(100),
    userID int NOT NULL ,
    CONSTRAINT urpk PRIMARY KEY (roleName),
    CONSTRAINT urfk FOREIGN KEY (userID) REFERENCES user_accounts(userID)
);

CREATE TABLE account_privileges(
    pid int NOT NULL ,
    accID int NOT NULL ,
    roleName varchar(100) NOT NULL ,
    CONSTRAINT appk PRIMARY KEY (pid, accID),
    CONSTRAINT apfk1 FOREIGN KEY (pid) REFERENCES privileges(pid),
    CONSTRAINT apfk2 FOREIGN KEY (roleName) REFERENCES user_role(roleName)
);

CREATE TABLE relation_privileges(
    pid int NOT NULL ,
    relationID int NOT NULL ,
    grantorID int NOT NULL ,
    roleName varchar(100) ,
    tableName varchar(100),
    CONSTRAINT rppk PRIMARY KEY (pid, relationID),
    CONSTRAINT rpfk1 FOREIGN KEY (pid) REFERENCES privileges (pid),
    CONSTRAINT rpfk2 FOREIGN KEY (grantorID) REFERENCES user_accounts(userID)
);


CREATE TABLE has_access(
    roleName varchar(100) NOT NULL ,
    tableName varchar(100) NOT NULL ,
    relationID int NOT NULL ,
    CONSTRAINT hspk PRIMARY KEY (roleName, tableName)
);
